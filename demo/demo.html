<html>
    <head>
        <script type="text/javascript" src="jquery.js"></script>
        <script type="text/javascript" src="underscore.js"></script>
        <script type="text/javascript" src="require.js"></script>
    </head>
    <body>
        
        <pre id="preview"><a href="#" id="downloader" download="sample.xlsx">Click me!</a></pre>
        
        <script type="text/javascript">
            require.config({
                text: 'text.js',
                paths: {
                    underscore: 'underscore',
                    JSZip: '../jszip/jszip'
                },
                shim: {
                    'underscore': {
                        exports: '_'
                    },
                    'JSZip': {
                        exports: 'JSZip'
                    }
                }
            });
            require(['../excel-builder', 'text!testdata.json', '../Excel/Table'], function (builder, testdata, Table) {
                var data = JSON.parse(testdata);
                /* for converting data sets from key-> value to array of values
				var stuff = [];
				for(var i = 0, l = data.length; i < l; i++) {
					var d = data[i];
					stuff[i] = [
						d.id,
						d.name,
						d.price,
						d.location,
						d.startDate,
						d.endDate
					];
				}
				console.log(JSON.stringify(stuff))
				*/
				
                var wb = builder.createWorkbook();
                var stylesheet = wb.getStyleSheet();
				
				var dateFormatter = stylesheet.createSimpleFormatter('date');
				
				var currencyFormatter = stylesheet.createFormat({format: "$ #,##0.00;$ #,##0.00;-"});
				
				var crazyStyle = stylesheet.createFormat({
					font: {
						bold: true,
						italic: true,
						underline: true,
						strike: true,
						outline: true,
						shadow: true,
						size: 20
					}
				});
				
				var boldStyle = stylesheet.createFormat({
					font: { bold: true, underline: true},
					alignment: 'center'
				});
				
                var columns = [
                    {id: 'id', type: 'number', style: crazyStyle.id, width: 20},
                    {id: 'name', type: 'string', width: 50},
                    {id: 'price', type: 'number', style: currencyFormatter.id},
                    {id: 'location', type: 'string'},
                    {id: 'startDate', type: 'date', style: dateFormatter.id, width: 15},
                    {id: 'endDate', type: 'date', style: dateFormatter.id, width: 15}
                ];
                
                var ws = wb.createWorksheet();
                wb.addWorksheet(ws);
                ws.setColumns(columns);
				var worksheetData = [
					[
						{value: "ID", metadata: {style: boldStyle.id, type: 'string'}}, 
						{value: "Name", metadata: {style: boldStyle.id, type: 'string'}}, 
						{value: "Price", metadata: {style: boldStyle.id, type: 'string'}}, 
						{value: "Location", metadata: {style: boldStyle.id, type: 'string'}}, 
						{value: "Start Date", metadata: {style: boldStyle.id, type: 'string'}},
						{value: "End Date", metadata: {style: boldStyle.id, type: 'string'}}
					]
				].concat(data.slice(0, 50));
				ws.setHeader([
					[
						{bold: true, text: "Generic Report"},
						" - built on ",
						{underline: true, text: "5/7/9"}
					],
					"Center Column",
					"Right Column"
				]);
				ws.setFooter([
					'',
					'',
					'Page &P of &N'
				])
                ws.setData(worksheetData);
				ws.setPageOrientation('landscape');
				
				var table = new Table();
				table.setReferenceRange([1, 1], [6, worksheetData.length]
				ws.addTable(table);
                $("#downloader").attr({
                    href: "data:application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;base64,"+builder.createFile(wb)
                });
            });
            
        </script>
        
    </body>
</html>